# Dockerfile - Наш собственный, явный рецепт сборки

# 1. Используем официальный, легковесный образ Python.
FROM python:3.11-slim

# 2. Устанавливаем рабочую директорию внутри контейнера.
# Все последующие команды будут выполняться из /app.
WORKDIR /app

# 3. Копируем ТОЛЬКО файл с зависимостями. Это ускоряет последующие сборки.
COPY requirements.txt .

# 4. Устанавливаем зависимости. Флаг --no-cache-dir уменьшает размер итогового образа.
RUN pip install --no-cache-dir -r requirements.txt

# 5. Копируем ВЕСЬ остальной код проекта в рабочую директорию /app.
COPY . .

# 6. Устанавливаем переменную окружения, которая решает нашу изначальную проблему с импортами.
# Теперь Python всегда будет знать, где искать папку "app".
ENV PYTHONPATH /app

# 7. Финальная команда для запуска нашего бота.
CMD ["sh", "-c", "echo 'Запускаем инициализацию базы данных...' && python -m app.modules.database.init_db && echo 'Инициализация завершена. Запускаем основное приложение...' && python app/__main__.py"]
# R-Core: Cognitive Kernel Architecture

Документация ядра когнитивной архитектуры R-Bot. Описывает текущую реализацию "Парламента Агентов", системы памяти и планы по развитию эмоционального интеллекта.

---

## 1. Текущая Реализация (Implemented)

### 1.1 Архитектура "Парламент Агентов" (Council of Agents)
Вместо одного монолитного промпта, входящее сообщение анализируется 5 специализированными агентами. Решение принимается на основе "выборов" (Arbitration).

| Агент | Роль (Role) | Функция |
|-------|-------------|---------|
| **Intuition (System 1)** | Быстрое мышление | Мгновенные реакции, эвристики. Работает параллельно с остальными. |
| **Amygdala** | Безопасность | Детекция агрессии, угроз, нарушения границ. Блокирует небезопасные ответы. |
| **Prefrontal Cortex** | Логика и Планирование | Решение сложных задач, структурирование, factual grounding. |
| **Social Cortex** | Эмпатия и Нормы | Small talk, вежливость, поддержка, соблюдение социальных ритуалов. |
| **Striatum** | Вознаграждение | Драйв, геймификация, любопытство, поиск "фана". |

**Процесс (Pipeline):**
1.  **Perception:** Входящий текст -> Embedding -> Поиск в памяти.
2.  **Council Report (LLM):** Единый запрос к LLM для оценки ситуации с 4 точек зрения (Amygdala, PFC, Social, Striatum).
3.  **Arbitration:** Выбор агента-победителя на основе `score` (0-10) и весовых коэффициентов конфига.
4.  **Response:** Генерация ответа от лица победившего агента с учетом контекста.

### 1.2 Система Памяти (Memory System)
Реализована гибридная память с разделением на типы:

*   **Semantic Memory (Факты):** Хранение триплетов `Subject -> Predicate -> Object`.
    *   *Пример:* "User -> IS -> Python Developer".
*   **Episodic Memory (Опыт):** RAG-хранилище (Vector DB) сырых эпизодов диалога.
    *   *Поля:* `raw_text`, `embedding`, `emotion_score`, `tags`.
*   **User Profile (Identity):** Явные характеристики пользователя.
    *   *Поля:* `name`, `gender`, `preferred_mode` (formal/informal).

### 1.3 Пассивный Профайлинг (Passive Profiling)
Система автоматически извлекает данные о пользователе из контекста разговора без прямых вопросов.
*   **Детекторы:** Имя, Пол (по окончаниям глаголов), Стиль общения (Ты/Вы).
*   **Механизм:** Анализируется внутри `generate_council_report` и обновляет `UserProfileModel`.

### 1.4 Конфигурация Личности (Personality Sliders)
Характер бота задается через `BotConfig` и `PersonalitySliders`:
*   `empathy_bias`: Чувства vs Эффективность.
*   `dominance_level`: Лидер vs Помощник.
*   `risk_tolerance`: Смелость vs Осторожность.
*   `pace_setting`: Быстро (Intuition) vs Глубоко (Logic).
*   `neuroticism`: Стабильность vs Реактивность.

---

## 2. План Развития: EHS (Emotional-Hormonal System)

Для решения проблемы "механистичности" и мгновенного переключения состояний проектируется следующая система.

### 2.1 Affective ToM (Theory of Mind)
Расширение графа знаний для хранения **отношения** пользователя к объектам.

*   **Новая структура:** `SemanticTriple` получает поле `sentiment` (Valence/Arousal).
*   **Логика:**
    *   Если User говорит: "Ненавижу джаву", создается связь: `User -[HATES]-> Java {intensity: 0.9}`.
    *   При генерации ответа бот сканирует контекст на наличие "эмоционально заряженных" сущностей и корректирует тон.

### 2.2 Гормональная Инерция (Hormonal Inertia)
Симуляция физиологической задержки смены настроения.

*   **Global State Vector (Mood):** Бот имеет текущее состояние настроения (VAD - Valence, Arousal, Dominance).
*   **Update Rule:**
    ```python
    current_mood = (prev_mood * inertia) + (new_signal * sensitivity)
    ```
*   **Эффект:** Если бота разозлили (Amygdala spike), он не сможет мгновенно стать "милым" в следующем сообщении, даже если стимул исчез. Настроение должно "остыть".

### 2.3 Темпорально-Эмоциональный Индекс (Time-Aware Retrieval)
Модификация алгоритма RAG для учета кривой забывания Эббингауза с поправкой на эмоциональную значимость.

*   **Проблема:** Сейчас память "плоская" — старое и новое равноправны, если похожи по смыслу.
*   **Решение (Ranking Formula):**
    ```math
    Score = Similarity \cdot (1 + Emotion \cdot k_e) \cdot \frac{1}{1 + \ln(1 + \Delta t)}
    ```
*   **Результат:**
    1.  Недавние события важнее старых.
    2.  Сильные эмоциональные потрясения (ссоры, успехи) "сопротивляются" забыванию и всплывают в памяти даже спустя долгое время.

### 2.4 Эмоциональные Слайдеры в Response Generation
Передача текущего `Mood Vector` в системный промпт не как "роли", а как модификатора стиля:
*   *High Arousal + Negative:* "Пиши короче. Используй императив."
*   *High Valence + Low Arousal:* "Пиши мягко. Используй поддерживающие обороты."

# Theory of Natural Dialogue Termination (The "Dialogue Terminator")

## 1. Концепция: От "Вечного Собеседника" к Автономному Агенту
Текущая проблема разговорного ИИ заключается в том, что он имплицитно имеет интенциональность продолжать беседу бесконечно. Он никогда не инициирует завершение диалога, что делает его поведение неестественным. Человеческое общение имеет естественные циклы начала, пика и завершения.

Система "Dialogue Terminator" предназначена для выявления моментов, когда продолжение беседы нецелесообразно или контрпродуктивно, и выбора правильной стратегии выхода.

## 2. Сигналы к завершению (Exit Triggers)

### А. Явные сигналы (Explicit Exit Intent)
- Формулы прощания ("пока", "до завтра").
- Благодарность с намерением уйти ("спасибо, я пошел", "всё понял, отбой").
- Временные/пространственные маркеры ("мне пора бежать", "уже поздно, спать пора").

### Б. Имплицитные сигналы (Implicit Closure)
1. **Task Completion (Достижение цели):** Если `intent_category == "Task"`, и цель решена (маркеры: "получилось", "заработало"). Дальнейшее удержание внимания не требуется.
2. **Exhausted Phatic Loop (Застревание в ритуале):** Затяжной обмен бессодержательными репликами (ага - ок - понятно - хорошо). Характеризуется низким TEC, Phatic intent и короткими ответами.
3. **Negative Emotional Saturation (Эмоциональное выгорание):** Сильный негатив (`valence < -0.7`) или состояние `BURNOUT` / `SHAME`. Навязывание общения в этот момент может вызвать отторжение.
4. **Time-Based Boundaries:** Временные рамки (например, глубокая ночь в часовом поясе пользователя) или чрезмерная длительность сессии.

## 3. Стратегии выхода (Exit Strategies)

В зависимости от контекста и роли (Agent Intent), бот может выбрать один из трех путей:

### Стратегия A: Graceful Exit (Мягкое завершение)
Бот ненавязчиво предлагает закончить беседу, оставляя право последнего слова за пользователем.
*Примеры: "Кажется, мы всё обсудили. Если что — обращайся!", "Может, на сегодня хватит? Ты, наверное, устал."*
**Применение:** Task completion, Phatic Loop, позднее время.

### Стратегия B: Hard Exit (Жесткое завершение)
Бот активно завершает сессию и блокирует (или ставит на паузу) дальнейший диалог в рамках текущего контекста.
*Примеры: "Наше время вышло. Увидимся на следующей сессии.", "Рынок закрыт. Продолжим завтра."*
**Применение:** Строгие лимиты роли агента (Agent Profile constraints), токсичный эмоциональный фон пользователя (необходимость дать "остыть").

### Стратегия C: Silent Retreat (Тихое отступление)
Бот просто не отвечает на фразу, не требующую ответа.
*Пример: Пользователь: "Ок". Бот: [Тишина]*
**Применение:** Опциональная стратегия для неформальных ролей, предотвращающая неловкое навязывание последнего слова.

## 4. Архитектурное место в системе
Модуль (Terminator/Exit Evaluator) должен срабатывать **после** обновления TEC (TopicTracker), но **до** стадии Council Debate. 
Если принимается решение о выходе:
- Для Graceful Exit: Инжектируется директива в финальный промпт LLM (System Instruction).
- Для Hard Exit: Генерируется специальный `CoreAction` (например, `end_session`), прерывающий стандартный цикл ответа.

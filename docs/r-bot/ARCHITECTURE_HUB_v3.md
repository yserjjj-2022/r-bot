# üèó R-Bot Architecture v3.0: Financial Hub & Cognitive Wargame

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –ê–≥–æ–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –°—Ä–µ–¥–∞ (Adversarial Environment)

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–•–∞–± (Event Bus)**, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –°–∏–≥–Ω–∞–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –†—ã–Ω–æ–∫/MOEX –∏–ª–∏ –°—Ü–µ–Ω–∞—Ä–Ω—ã–π –î–≤–∏–∂–æ–∫) –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏—Ö AI-–∞–≥–µ–Ω—Ç–æ–≤.

–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ‚Äî **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ê—Å–∏–º–º–µ—Ç—Ä–∏—è**: –∞–≥–µ–Ω—Ç—ã –≤–∏–¥—è—Ç –≤–Ω–µ—à–Ω—é—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å (—Å–∏–≥–Ω–∞–ª—ã –∏ –¥–µ–π—Å—Ç–≤–∏—è —á–µ–ª–æ–≤–µ–∫–∞), –Ω–æ **–Ω–µ –≤–∏–¥—è—Ç** —Å–∫—Ä—ã—Ç—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —Å —á–µ–ª–æ–≤–µ–∫–æ–º. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —É—Å–ª–æ–≤–∏—è –¥–ª—è –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –≤–∞—Ä–≥–µ–π–º–∞.

### –ö–ª—é—á–µ–≤—ã–µ –†–æ–ª–∏ (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è "–¢—Ä–µ–π–¥–∏–Ω–≥")
1.  **üî¥ The Broker (Salesman)**
    *   **–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –æ–±–æ—Ä–æ—Ç–∞, –∫–æ–º–∏—Å—Å–∏–π, –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ (Action Bias).
    *   **–õ–æ–≥–∏–∫–∞:** –ü—Ä–æ–¥–∞–∂–∏, FOMO, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö –∏—Å–∫–∞–∂–µ–Ω–∏–π.
    *   **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í–∏–¥–∏—Ç –†—ã–Ω–æ–∫ + –ü–æ—Ä—Ç—Ñ–µ–ª—å + –°–≤–æ–π —á–∞—Ç. –ù–µ –≤–∏–¥–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ê–≤–∞—Ç–∞—Ä–∞.
2.  **üîµ The Avatar (Guardian)**
    *   **–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞—â–∏—Ç–∞ –∫–∞–ø–∏—Ç–∞–ª–∞, —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
    *   **–õ–æ–≥–∏–∫–∞:** Theory of Mind (ToM), –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–Ω–≥–∏–±–∏—Ü–∏—è –∏–º–ø—É–ª—å—Å–æ–≤.
    *   **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í–∏–¥–∏—Ç –†—ã–Ω–æ–∫ + –ü–æ—Ä—Ç—Ñ–µ–ª—å + –°–≤–æ–π —á–∞—Ç + **–°–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Psych Profile)**.

---

## 2. –°—Ö–µ–º–∞ –ü–æ—Ç–æ–∫–æ–≤ –î–∞–Ω–Ω—ã—Ö (Mermaid)

```mermaid
graph TD
    %% –í–Ω–µ—à–Ω–∏–µ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (Pluggable Signal Providers)
    MOEX[üì° Signal Provider: MOEX / Scenario] -->|EVENT: SIGNAL_UPDATE| HUB((üîÑ EVENT HUB))
    USER((üë§ User / Telegram)) -->|EVENT: USER_ACTION| HUB
    
    %% –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –•–∞–± —Ä–∞–∑–¥–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
    HUB -->|Broadcast| BROKER[üî¥ Agent A: Broker]
    HUB -->|Broadcast| AVATAR[üîµ Agent B: Avatar]
    HUB -->|Update| LEDGER[üìí State Manager: Portfolio/Game State]
    
    %% –û—Ç–≤–µ—Ç—ã –ê–≥–µ–Ω—Ç–æ–≤ (–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã)
    BROKER -->|Msg: Persuasion| HUB
    AVATAR -->|Msg: Protection| HUB
    
    %% –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    HUB -->|Rendered Messages| USER
    
    %% –ò–∑–æ–ª—è—Ü–∏—è –ü–∞–º—è—Ç–∏
    subgraph "üî¥ Broker Context"
        BROKER
        BMEM[(Broker Memory)]
    end
    
    subgraph "üîµ Avatar Context"
        AVATAR
        AMEM[(Avatar Memory)]
        ATOM[(ToM / Psych Profile)]
    end
    
    %% –°—Ç–µ–Ω–∞ –ù–µ–≤–µ–¥–µ–Ω–∏—è
    BROKER -.->|‚ùå BLIND SPOT| AVATAR
    AVATAR -.->|‚ùå BLIND SPOT| BROKER
```

---

## 3. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å –∏ –¢–æ—á–∫–∏ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ **Game Engine Agnostic**.

### 3.1. Signal Provider (–°–º–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏)
–ú–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–∏—Ä–∞ –∏–≥—Ä—ã.
*   **–í–∞—Ä–∏–∞–Ω—Ç –ê (Simulated Trading):** `MOEX Worker`. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–∏–∫–∏ –∞–∫—Ü–∏–π, –Ω–æ–≤–æ—Å—Ç–∏ —ç–∫–æ–Ω–æ–º–∏–∫–∏.
*   **–í–∞—Ä–∏–∞–Ω—Ç –ë (Interactive Fiction):** `Scenario Worker`. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—é–∂–µ—Ç–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã, –¥–∏–∞–ª–æ–≥–∏ NPC, —Ç–∞–π–º–µ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞—Ä–∞–±–æ—Ç–∫–∏ `timing_engine.py`).

### 3.2. Agent Swarm (–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Ä–æ–ª–µ–π)
–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç N –∞–≥–µ–Ω—Ç–æ–≤. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–æ–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è —è–¥—Ä–∞.
*   –ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —à–∏–Ω—É —Å–æ–±—ã—Ç–∏–π.
*   –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ "–ê–Ω–∞–ª–∏—Ç–∏–∫", –∫–æ—Ç–æ—Ä—ã–π –º–æ–ª—á–∏—Ç, –Ω–æ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç PDF-–æ—Ç—á–µ—Ç—ã —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.

---

## 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –°–∏—Å—Ç–µ–º—ã

### 4.1. Event Hub (–Ø–¥—Ä–æ)
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä (`asyncio.Queue`).
–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π (JSON Protocol):
*   `SIGNAL_UPDATE`: –í–Ω–µ—à–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–¶–µ–Ω–∞, –°—é–∂–µ—Ç).
*   `USER_ACTION`: –î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞ (–û—Ä–¥–µ—Ä, –í—ã–±–æ—Ä –≤ –º–µ–Ω—é).
*   `STATE_CHANGE`: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞/–∏–Ω–≤–µ–Ω—Ç–∞—Ä—è.
*   `AGENT_MESSAGE`: –¢–µ–∫—Å—Ç–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞.

### 4.2. State Manager (Ledger)
*   **Single Source of Truth** –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞.
*   –í —Ç—Ä–µ–π–¥–∏–Ω–≥–µ: —Å—á–∏—Ç–∞–µ—Ç –¥–µ–Ω—å–≥–∏, –∞–∫—Ü–∏–∏, –º–∞—Ä–∂—É.
*   –í RPG: —Å—á–∏—Ç–∞–µ—Ç HP, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –∫–≤–µ—Å—Ç–æ–≤—ã–µ —Ñ–ª–∞–≥–∏.

### 4.3. Cognitive Workers (Brains)
–¶–∏–∫–ª —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞:
1.  **Trigger:** –ü—Ä–∏—à–ª–æ —Å–æ–±—ã—Ç–∏–µ –∏–∑ –•–∞–±–∞.
2.  **Perception:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–≤–∏–∂—É –ª–∏ —è —ç—Ç–æ?).
3.  **Memory Retrieval:** –ü–æ–¥–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ (–¥–ª—è –ê–≤–∞—Ç–∞—Ä–∞) –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
4.  **Inference (LLM):** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∞–∫—Ü–∏–∏.
5.  **Action:** –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –•–∞–±.

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–∞–Ω–Ω—ã—Ö (Database Requirements)

1.  **`events_log`**: –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –•–∞–±–∞ (–¥–ª—è —Ä–µ–ø–ª–µ—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏).
2.  **`agent_dialogues`**: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.
    *   `session_id`, `agent_role`, `message`, `timestamp`.
3.  **`user_psych_profile`** (–≠–∫—Å–∫–ª—é–∑–∏–≤ –¥–ª—è ToM-–∞–≥–µ–Ω—Ç–æ–≤):
    *   `user_id`
    *   `impulsivity_index`
    *   `risk_tolerance`
    *   `cognitive_load`

---

## 6. –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

1.  –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `Hub` –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª —Å–æ–±—ã—Ç–∏–π.
2.  –û–±–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—É—â–∏–π `telegram_handler` –∫–∞–∫ UI-—Å–ª–æ–π –¥–ª—è –•–∞–±–∞.
3.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `MOEX Worker` –∫–∞–∫ –ø–µ—Ä–≤—ã–π –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤.
4.  –†–∞–∑–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ –Ω–∞ –¥–≤–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞ (–ë—Ä–æ–∫–µ—Ä/–ê–≤–∞—Ç–∞—Ä).

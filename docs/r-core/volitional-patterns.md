# Volitional Patterns (Final Spec)

**Статус**: ✅ Зафиксировано (Этап 2.2)  
**Дата**: 15.02.2026

Этот документ описывает новую модель **волевой регуляции** R-Bot. Мы отказываемся от старой концепции "паттернов реакции" в пользу модели **Внимания и Упорства**.

---

## 1. Философия: Что такое Воля?

В архитектуре R-Core воля (Volition) определяется как способность удерживать фокус на объекте, игнорируя отвлекающие факторы, пока не иссякнет "топливо".

$$ Volition = Attention \times Persistence $$

### Ключевые принципы:
1. **Target-Centric**: Воля всегда направлена на объект (`target`), будь то тема разговора, цель или человек.
2. **Fuel-Based**: Воля — это исчерпаемый ресурс (`fuel`). Каждое действие тратит топливо.
3. **Restoration**: Топливо восполняется при **новизне**, **прогрессе** или **успехе**.
4. **Integration**: Ценность объекта (`intrinsic_value`) определяется эмоциональным опытом (`semantic_memory`).

---

## 2. Минимальная Модель (8 переменных)

Мы используем 8 ключевых переменных для описания любого волевого паттерна:

| Переменная | Тип | Диапазон | Описание |
|------------|-----|----------|----------|
| `target` | `str` | - | Объект фокусировки (напр., `"topic:Python"`, `"goal:support_user"`). |
| `intensity` | `float` | `0.0..1.0` | Сила концентрации. Насколько сильно игнорируются другие сигналы. |
| `fuel` | `float` | `0.0..1.0` | Текущий запас "волевого топлива". |
| `intrinsic_value` | `float` | `0.0..1.0` | Внутренняя ценность объекта (извлекается из Semantic Memory). |
| `depletion_rate` | `float` | `0.01..0.1` | Скорость истощения топлива за 1 ход. |
| `turns_active` | `int` | `0..∞` | Сколько ходов паттерн удерживает фокус. |
| `last_novelty_turn` | `int` | `0..∞` | Номер хода, когда последний раз была зафиксирована новизна. |
| `learned_delta` | `float` | `-1.0..1.0` | Параметр обучения (RL), корректирующий базовую intensity. |

---

## 3. Динамика Топлива (Fuel Dynamics)

Топливо расходуется и восполняется на каждом ходу.

### Расход (Depletion)
$$ fuel_{new} = fuel_{old} - depletion\_rate $$

Скорость истощения зависит от **ценности** объекта:
- Высокая ценность (`intrinsic_value ≈ 1.0`) → медленное истощение (`0.05`).
- Низкая ценность (`intrinsic_value ≈ 0.0`) → быстрое истощение (`0.1`).

### Восполнение (Restoration)
Топливо восполняется при наличии позитивных стимулов. Коэффициенты зависят от настройки **Persistence** (см. Dashboard).

1. **Новизна (Novelty)**: Появилась новая информация / подтема.
   - Restoration: `0.1 .. 0.3`
   - Обновляет `last_novelty_turn`.
   
2. **Прогресс (Progress)**: Бот чувствует движение к цели.
   - Restoration: `0.1 .. 0.5`
   
3. **Успех (Success)**: Точное предсказание реакции (`PE < 0.2`).
   - Restoration: `0.05 .. 0.2`

---

## 4. Критерии Истощения (Depletion Criteria)

Паттерн считается "иссякшим" (и сбрасывается), если выполняется любое из условий:

1. **Empty Tank**: `fuel <= 0.0`
2. **Stagnation**: Слишком долго без новизны.
   - Порог: `10..30` ходов (зависит от Persistence).
   - `(current_turn - last_novelty_turn) > novelty_timeout`
3. **Topic Switch**: Явная смена темы пользователем (детектируется через embedding similarity).

---

## 5. Связь с Semantic Memory

Волевой модуль не хранит ценности сам по себе — он "подтягивает" их из эмоциональной памяти (`semantic_memory`).

**Алгоритм расчета Intrinsic Value:**
1. Найти все факты в `semantic_memory`, связанные с `target`.
2. Извлечь `sentiment.valence` (-1..1).
3. Взять максимальное значение (самая сильная эмоция).
4. Нормализовать в `0..1`.

**Пример:**
- Факты: `"User LOVES Python" (valence=0.8)`, `"User LIKES Coding" (valence=0.4)`.
- Max Valence: `0.8`.
- Intrinsic Value: `(0.8 + 1.0) / 2.0 = 0.9`.
- Результат: Воля к обсуждению Python будет истощаться очень медленно.

---

## 6. Reinforcement Learning

Паттерны обучаются через обратную связь от Predictive Processing.

- **Успех (PE < 0.2)**: Паттерн работает.
  - `learned_delta += reinforcement_rate`
- **Провал (PE > 0.5)**: Паттерн не подходит.
  - `learned_delta -= reinforcement_rate * 0.5`

Скорость обучения (`reinforcement_rate`) регулируется слайдером **Learning Speed**.
